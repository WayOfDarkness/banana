{% extends "layout.twig" %}

{% block pre_include %}
    <title>{{settings.meta_title ? settings.meta_title : settings['shop_name']}}</title>
{% endblock %}

{% block post_include %}

  <script>
    function loadFilter(){
      var max_price = $('input[name="max-price-filter"]').val();
      var min_price = $('input[name="min-price-filter"]').val();
      if ($('select[name="sortBy"]').val() ) {
        sortbyValue = $('select[name="sortBy"]').val() ;
      }
      if ($('select[name="soluong1"]').val() ) {
        perpageValue = $('select[name="soluong1"]').val() ;
      }

      sortby = '&sortby=' + sortbyValue ;
      perpage = '&perpage=' + perpageValue;

      var filter = '&filter=' + 'price>=' + min_price + '%26%26price<=' + max_price;
      var attributes_url = loadfilterUrl()
      if (!attributes_url  && ! check_price_filter && !filter) {
        $('#filter-content').html(root_html);
        return;
      }
      var url = '/api/search?type=product&view=snippet%2Fcollection_filter&attr=' + attributes_url + filter + perpage + sortby;
      // return;
      ajaxLoadFilter(url);
    }

    function loadfilterUrl() {
        var url = ''
        var count = 0;
        $('.filter-left-aside .filter-attributes .reset-list').each(function (val) {
            var option = $(this).data('option');
            var option_array_value = []
            var value_attribute = $(this).find('li input:checked').each(function (data) {
                option_array_value.push($(this).data('value'));
            })
            if (option_array_value.length > 0) {
                if (count) {
                    url += '&&' + option + 'IN' + JSON.stringify(option_array_value);
                } else {
                    url += option + 'IN' + JSON.stringify(option_array_value);
                }
                count++;
            }
        })
        console.log(url);
        return encodeURIComponent(url);
    }

    function ajaxLoadFilter(url) {
      $.ajax({
          url: url,
          type: 'GET',
          success: function (html) {
              $('#filter-content').html(html);
              initPaginate(url);
              initRating();

          }
      })
    }
  </script>
{% endblock %}

{% block content %}
   <div id="site-wrapper">
    <div id="mantle_skin">
      <div id="rbSkin" class="rbSkin">
        <span id="adSkinLeft"></span>
        <span id="adSkinRight"></span>
        <div class="mapped-ad mapped-skin_top">
          <div id="skin_top" class="ad-wrap"></div>
        </div>
        <div id="wrapper">
          {% include 'snippet/index-featured-post.twig' %}
          <div id="site" role="main">
            <div id="default-content" class=" container row">
              {% include 'snippet/index-featured-slider.twig' %}
              <div id="leader_plus_top-wrap" class="mapped-ad mapped-leader_plus_top">
                <div id="leader_plus_top" class="ad-wrap"></div>
              </div>
              {% include 'snippet/index-content.twig' %}
              {% include 'snippet/index-rightside-reviews.twig' %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
